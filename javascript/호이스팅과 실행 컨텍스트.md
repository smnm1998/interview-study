# 호이스팅(Hoisting)과 실행 컨텍스트

## 1. 호이스팅 정의와 오해

많은 개발자가 호이스팅을 "변수나 함수 선언문이 코드의 최상단으로 끌어올려지는 현상"이라고 단순한게 정의한다. 하지만 이는 현상을 설명하는 비유일 뿐, 실제 자바스크립트 엔진이 코드를 물리적으로 이동시키는 것은 아니다.

정확한 정의는 **자바스크립트 엔진이 소스코드를 실행하기 전, 변수와 함수의 선언 정보를 수집하여 메모리에 미리 등록하는 과정에서 발생하는 현상**이다. 이 과정 덕분에 개발자는 변수가 선언된 위치보다 앞서서 해당 변수를 참조하거나 사용할 수 있게 된다.

## 2. 발생 원리 - 실행 컨텍스트의 생성 단계

호이스팅을 완벽하게 이해하기 위해서는 자바스크립트 엔진의 동작 단계를 알아야 한다. 엔진은 코드를 만나면 즉시 실행하지 않고 두 가지 단계를 거친다.

1. **생성 단계**: 코드를 실행하기 전, 전체 코드를 스캔한다. 이때 변수명과 함수 선언문을 찾아 **실행 컨텍스트**의 렉시컬 환경에 등록한다.
2. **실행 단계**: 등록된 정보를 바탕으로 코드를 한 줄씩 순차적으로 실행하며 값을 할당한다.

즉, 우리가 코드를 실행하는 시점에는 이미 엔진이 모든 변수의 이름을 알고 있는 상태이기 때문에 선언문보다 앞서 호출해도 에러가 발생하지 않는 것이다.

## 3. 변수 호이스팅의 차이 (`var` vs `let`/`const`)

"`let`과 `const`는 호이스팅 되지 않는다."는 흔한 오해가 있지만, 이는 사실이 아니다. 자바스크립트의 모든 선언은 호이스팅이 가능하다. 다만, **변수가 생성되는 과정(선언-초기화-할당)** 에서 차이가 있을 뿐이다.

### 3.1 `var`키워드

`var`로 선언된 변수는 **선언 단계와 초기화 단계가 동시에 진행된다. 실행 컨텍스트에 변수명을 등록함과 동시에 `undefined`로 메모리를 초기화해 버린다. 따라서 변수 선언문 이전에 접근하더라도 에러 대신 `undefined`가 반환된다. 이는 코드의 흐름을 예측하기 어렵게 만드는 주원인이다.

### 3.2 `let`/`const` 키워드 (TDZ)

`let`과 `const` 역시 호이스팅되어 실행 컨텍스트에 등록된다. 하지만 `var`와 달리 **선언 단계와 초기화 단계가 분리**되어 있다. 변수명은 등록되었지만, 실제 코드의 선언문에 도달하기 전까지는 메모리가 초기화되지 않은 상태로 남는다.

이처럼 **스코프의 시작 지점부터 초기화 시작 지점까지 변수를 참조할 수 없는 구간**을 **TDZ(Temporal Dead Zone, 일시적 사각지대)** 라고 부른다. 이 구간에서 변수에 접근하면 `ReferenceError`가 발생하여 더 안전한 코딩을 유도한다.

```javascript
// TDZ 구간 시작
console.log(name);

let name = "Frontend";
console.log(name);
```

## 4. 함수 호이스팅 - 선언문과 표현식

함수를 정의하는 방식에 따라서도 호이스팅의 동작이 완전히 다르다. 이 차이는 면접에서 자주 묻는 주제 중 하나다.

- 함수 선언문(Function Declaration): `function a() { ... }`형태다. 함수 선언문은 **함수 객체 전체가 호이스팅**된다. 따라서 선언 전에도 함수를 문제없이 호출하여 사용할 수 없다.
- 함수 표현식(Function Expression): `const a = function() { ... }`형태다. 이는 변수 호이스팅 규칙을 따른다. 변수명만 호이스팅되고 함수 본문은 할당되지 않았기 때문에, 할당문 이전에 호출하면 에러(var는 `TypeError`, let/const는 `ReferenceError`)가 발생한다.

## 5. 결론

호이스팅은 자바스크립트 언어의 고유한 특성이지만, 이를 남용하면 코드의 가독성을 해치고 유지보수를 어렵게 만든다.

1. **변수는 최상단에**: 가급적 스코프의 상단에서 변수를 선언하여 호이스팅으로 인한 혼란을 줄인다.
2. **`let`, `const` 사용**: 의도치 않은 `undefined` 참조를 막기 위해 `var` 사용을 지양한다.
3. **함수 표현식 또는 화살표 함수 권장**: 함수 역시 변수에 할당하여 사용하여, 선언된 이후에만 호출할 수 있도록 코드 흐름을 강제하는 것이 좋다.

## 6. 참고자료

<a href="https://developer.mozilla.org/ko/docs/Glossary/Hoisting">MDN Web Docs</a>
<a href="https://ko.javascript.info/closure">Modern JavaScript Tutorial</a>
<a href="https://ui.toast.com/weekly-pick/ko_20191014">Toast UI</a>
